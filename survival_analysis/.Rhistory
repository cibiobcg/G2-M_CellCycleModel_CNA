))
ggplot(survival, aes(x=sim_time, fill=Group))+
geom_histogram(bins = 30,
position = "identity",
alpha = 0.45,
color = "black", aes(y = after_stat(count / sum(count) * 100)))+
theme_minimal(base_size = 14)+
labs(x='Patients mean switch time', y='Percentage of patients', title='Switch time distribution') +
scale_fill_manual( values=grp_cols)
prova<-survival[order(survival$sim_time),,drop=F]
## For the switch percentage
km_perc<-kmeans(survival$sim_perc, centers = 2)
prova <-survival
prova$clust2<-as.factor(km_perc$cluster)
prova <- prova %>%
mutate(Group2 = case_when(
clust2 == 2 ~ "high",
clust2 == 1 ~ "low",
TRUE ~ NA_character_
))
grp_cols <- c("high" = "#1b9e77", "low" = "#d95f02")
ggplot(prova, aes(x=sim_perc, fill=Group2))+
geom_histogram( bins = 30,position = "identity",
alpha = 0.45, color = "black",aes(y = after_stat(count /sum(count) * 100)))+
theme_minimal(base_size = 14) +
labs(x='Patient mean switch percentage', y='Counts', title='Switch percentage distribution') +
scale_fill_manual(values= grp_cols)+scale_y_break(c(5,82))
prova<-prova[order(prova$sim_perc),,drop=F]
qual_colors<-brewer.pal.info[brewer.pal.info$category=='qual',]
col_vector<-unlist(mapply(brewer.pal, qual_colors$maxcolors, rownames(qual_colors)))
colors<-sample(col_vector, 2)
surv_data <- survival
surv_data$delayed_switch_time <- as.integer(surv_data$clust)
surv_data[which(surv_data$clust == 2),]$delayed_switch_time <- 1
surv_data[which(surv_data$clust == 1),]$delayed_switch_time <- 0
colnames(surv_data)[4] = "age_at_diagnosis"
param = "OS"
param.time = "OS.time"
fit = survfit(Surv(get(param.time), get(param)) ~ Group, data = surv_data)
plot(fit,xlab="Time (days)",ylab="Overall Survival",col=c('#d95f02','#1b9e77'),lwd=2,cex=1.5)
stats <- coxph(Surv(get(param.time), get(param)) ~ delayed_switch_time + age_at_diagnosis + subtype, data = surv_data)
summary(stats)
ggforest(stats)
ggsurvplot(fit,
conf.int=TRUE, # add confidence intervals
pval=TRUE, # show the p-value for the log-rank test
risk.table=TRUE, # show a risk table below the plot
legend.labs=c("delayed", "fast"), # change group labels
legend.title="Average switch time",  # add legend title
palette=c('#d95f02','#1b9e77'), # change colors of the groups
title="Kaplan-Meier Curve for Breast Cancer Survival", # add title to plot
risk.table.height=.2)
length(table(surv_data$age_at_diagnosis)) # 65
surv_data_switch <- prova
surv_data_switch$low_switch_commitment_percentage <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$low_switch_commitment_percentage <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$low_switch_commitment_percentage <- 1
colnames(surv_data_switch)[4] = "age_at_diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ low_switch_commitment_percentage + age_at_diagnosis + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2)
ggsurvplot(fit2,
conf.int=TRUE, # add confidence intervals
pval=TRUE, # show the p-value for the log-rank test
risk.table=TRUE, # show a risk table below the plot
legend.labs=c("high", "low"), # change group labels
legend.title="Switch percentage",  # add legend title
palette=c('#1b9e77','#d95f02'), # change colors of the groups
title="Kaplan-Meier Curve for Breast Cancer Survival", # add title to plot
risk.table.height=.2)
stats <- coxph(Surv(get(param.time), get(param)) ~ delayed_switch_time + age_at_diagnosis + subtype, data = surv_data)
ggforest(stats)
library(ggplot2)
library(survival)
library(survminer)
library(data.table)
library(RColorBrewer)
library(rstudioapi)
library(ggbreak)
library(dplyr)
library(ComplexHeatmap)
library(tidyr)
library(stringstatic)
library(stringr)
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
set.seed(123)
survival <- fread("../Files_generated/TCGATimePoints.tsv",data.table=F)
sims <- fread("../Files_generated/final_patient.csv",data.table=F)
sims$Patient_ID <- sapply(sims$Patient,function(x) paste(strsplit(x,"-")[[1]][1:3],collapse="-"))
survival <- survival[which(survival$type=="BRCA"),]
survival$sim_time <- NA
survival$sim_perc <- NA
survival$subtype <- NA
subtypes <- fread("../Files_generated/Cancer_subtypes_list.tsv",data.table=F)
for(i in 1:nrow(survival)){
t <- which(sims$Patient_ID==survival$bcr_patient_barcode[i])
if(length(t)>0)
{
survival$sim_time[i] <- sims$Mean[t] # for every patient associo il tempo medio a cui avviene lo switch
survival$sim_perc[i] <- sims$Percentage_switch[t] # for every patients i associate its switch percentage: quante volte su cento avviene lo switch
}
t <- which(subtypes$COMMON==survival$bcr_patient_barcode[i])
if(length(t)>0)
{
survival$subtype[i] <- subtypes$Subtype[t][1] # associo anche il subtype
}
}
survival <- survival[which(!is.na(survival$sim_time)),]
to_eliminate <- survival[which(is.na(survival$OS.time)),]$bcr_patient_barcode
survival <- survival[which(survival$bcr_patient_barcode != to_eliminate),]
hist(survival$sim_time,breaks=20,main="Switch time distribution",xlab="Patient mean switch time")
hist(survival$sim_perc[which(survival$sim_perc<100)],breaks=10,main="Switch percentage distribution\n(only for patients with percentages<100)",xlab="Patient mean switch percentage")
hist(survival$age_at_initial_pathologic_diagnosis,breaks=20,main="Age distribution",xlab="Age")
summary(survival$sim_time)
km<-kmeans(survival$sim_time, centers = 2)
survival$clust<-as.factor(km$cluster)
grp_cols <- c("fast" = "#1b9e77", "delayed" = "#d95f02")
survival <- survival %>%
mutate(Group = case_when(
clust == 2 ~ "delayed",
clust == 1 ~ "fast",
TRUE ~ NA_character_
))
ggplot(survival, aes(x=sim_time, fill=Group))+
geom_histogram(bins = 30,
position = "identity",
alpha = 0.45,
color = "black", aes(y = after_stat(count / sum(count) * 100)))+
theme_minimal(base_size = 14)+
labs(x='Patients mean switch time', y='Percentage of patients', title='Switch time distribution') +
scale_fill_manual( values=grp_cols)
prova<-survival[order(survival$sim_time),,drop=F]
## For the switch percentage
km_perc<-kmeans(survival$sim_perc, centers = 2)
prova <-survival
prova$clust2<-as.factor(km_perc$cluster)
prova <- prova %>%
mutate(Group2 = case_when(
clust2 == 2 ~ "high",
clust2 == 1 ~ "low",
TRUE ~ NA_character_
))
grp_cols <- c("high" = "#1b9e77", "low" = "#d95f02")
ggplot(prova, aes(x=sim_perc, fill=Group2))+
geom_histogram( bins = 30,position = "identity",
alpha = 0.45, color = "black",aes(y = after_stat(count /sum(count) * 100)))+
theme_minimal(base_size = 14) +
labs(x='Patient mean switch percentage', y='Counts', title='Switch percentage distribution') +
scale_fill_manual(values= grp_cols)+scale_y_break(c(5,82))
prova<-prova[order(prova$sim_perc),,drop=F]
qual_colors<-brewer.pal.info[brewer.pal.info$category=='qual',]
col_vector<-unlist(mapply(brewer.pal, qual_colors$maxcolors, rownames(qual_colors)))
colors<-sample(col_vector, 2)
surv_data <- survival
surv_data$delayed_switch_time <- as.integer(surv_data$clust)
surv_data[which(surv_data$clust == 2),]$delayed_switch_time <- 1
surv_data[which(surv_data$clust == 1),]$delayed_switch_time <- 0
colnames(surv_data)[4] = "age_at_diagnosis"
param = "OS"
param.time = "OS.time"
fit = survfit(Surv(get(param.time), get(param)) ~ Group, data = surv_data)
plot(fit,xlab="Time (days)",ylab="Overall Survival",col=c('#d95f02','#1b9e77'),lwd=2,cex=1.5)
stats <- coxph(Surv(get(param.time), get(param)) ~ delayed_switch_time + age_at_diagnosis + subtype, data = surv_data)
summary(stats)
ggforest(stats)
ggforest(stats, fontsize = 1)
surv_data <- survival
surv_data$"delayed switch time" <- as.integer(surv_data$clust)
colnames(surv_data)
surv_data[which(surv_data$clust == 2),]$delayed switch time <- 1
View(surv_data)
surv_data[which(surv_data$clust == 2),]$`delayed switch time` <- 1
surv_data[which(surv_data$clust == 1),]$`delayed switch time` <- 0
colnames(surv_data)[4] = "age at diagnosis"
param = "OS"
param.time = "OS.time"
fit = survfit(Surv(get(param.time), get(param)) ~ Group, data = surv_data)
plot(fit,xlab="Time (days)",ylab="Overall Survival",col=c('#d95f02','#1b9e77'),lwd=2,cex=1.5)
stats <- coxph(Surv(get(param.time), get(param)) ~ `delayed switch time` + `age ar diagnosis` + subtype, data = surv_data)
stats <- coxph(Surv(get(param.time), get(param)) ~ `delayed switch time` + `age at diagnosis` + subtype, data = surv_data)
summary(stats)
ggforest(stats, fontsize = 1)
ggsave('hazard_plot_switch_time.svg',plot = last_plot(),dpi = 360,width = 25, height = 25, units = "cm")
ggsurvplot(fit,
conf.int=TRUE, # add confidence intervals
pval=TRUE, # show the p-value for the log-rank test
risk.table=TRUE, # show a risk table below the plot
legend.labs=c("delayed", "fast"), # change group labels
legend.title="Average switch time",  # add legend title
palette=c('#d95f02','#1b9e77'), # change colors of the groups
title="Kaplan-Meier Curve for Breast Cancer Survival", # add title to plot
risk.table.height=.2)
length(table(surv_data$age_at_diagnosis)) # 65
surv_data_switch <- prova
surv_data_switch <- prova
surv_data_switch$low_switch_commitment_percentage <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$low_switch_commitment_percentage <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$low_switch_commitment_percentage <- 1
colnames(surv_data_switch)[4] = "age_at_diagnosis"
param = "OS"
surv_data_switch <- prova
surv_data_switch$"low switch commitment percentage" <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$`low switch commitment percentage` <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$`low switch commitment percentage` <- 1
colnames(surv_data_switch)[4] = "age at diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ low_switch_commitment_percentage + `age at diagnosis` + subtype, data = surv_data_switch)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ `low switch commitment percentage` + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2)
ggsurvplot(fit2,
conf.int=TRUE, # add confidence intervals
pval=TRUE, # show the p-value for the log-rank test
risk.table=TRUE, # show a risk table below the plot
legend.labs=c("high", "low"), # change group labels
legend.title="Switch percentage",  # add legend title
palette=c('#1b9e77','#d95f02'), # change colors of the groups
title="Kaplan-Meier Curve for Breast Cancer Survival", # add title to plot
risk.table.height=.2)
survival$groupST <- 0
survival$groupSP <- 0
survival$groupST[which(survival$sim_time>3290)] <- 1
survival$groupSP[which(survival$sim_perc<63)] <- 1
survival <- survival %>%
mutate(
GroupCombo = dplyr::case_when(
groupST == 1 & groupSP == 0 ~ "Delayed",
groupST == 0 & groupSP == 1 ~ "low CP",
groupST == 1 & groupSP == 1 ~ "Delayed + low CP",
groupST == 0 & groupSP == 0 ~ "None"
)
)
table(survival$GroupCombo)
pal <- brewer.pal(4, "Paired")
combo_cols <- c(
"Delayed" = pal[1],
"low CP" = pal[2],
"Delayed + low CP" = pal[3],
"None" = pal[4]
)
ggplot(survival, aes(x = sim_time, y = sim_perc, color = GroupCombo)) +
geom_point(size = 3, alpha = 0.8) +
scale_color_manual(values = combo_cols) +
theme_minimal() +
labs(color = "Group combination")
cnv_levels <- c("Diploid", "Gain", "Amplification", "Shallow Deletion", "Deep Deletion")
pattern <- paste0("^\\s*(.+?)\\s+(", paste(cnv_levels, collapse="|"), ")\\s*$")
sims$groupST <- 0
sims$groupSP <- 0
sims$groupST[which(sims$Mean>3290)] <- 1
sims$groupSP[which(sims$Percentage_switch<63)] <- 1
sims <- sims[which(!is.na(sims$Mean)),]
sims <- sims[which(sims$Patient_ID != to_eliminate),]
sims <- sims %>%
mutate(Group = case_when(
groupST == 1 ~ "delayed",
groupST == 0 ~ "fast",
TRUE ~ NA_character_
))
cnv_long <- sims %>%
select(Patient, Notes_situation_cp) %>%
mutate(Notes_situation_cp = as.character(Notes_situation_cp)) %>%
separate_rows(Notes_situation_cp, sep = "\\s*\\|\\s*") %>%
mutate(Notes_situation_cp = str_squish(Notes_situation_cp)) %>%
mutate(
Gene   = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,2],
Status = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,3]
) %>%
mutate(
Status = case_when(
str_to_lower(Status) == "diploid" ~ "Diploid",
str_to_lower(Status) == "gain" ~ "Gain",
str_to_lower(Status) == "amplification" ~ "Amplification",
str_to_lower(Status) == "shallow deletion" ~ "Shallow Deletion",
str_to_lower(Status) == "deep deletion" ~ "Deep Deletion",
TRUE ~ Status
)
)
cnv_wide <- cnv_long %>%
group_by(Gene, Patient) %>%
summarize(Status = Status[1], .groups = "drop") %>%
pivot_wider(names_from = Patient, values_from = Status, values_fill = "Diploid")
cnv_mat <- as.matrix(cnv_wide[,-1])
rownames(cnv_mat) <- cnv_wide$Gene
altered_genes <- rownames(cnv_mat)[apply(cnv_mat, 1, function(x) any(x != "Diploid"))]
cnv_mat_alt <- cnv_mat[altered_genes, , drop = FALSE]
annot_df <- sims %>%
distinct(Patient, Group) %>%
filter(Patient %in% colnames(cnv_mat_alt)) %>%
mutate(Patient = factor(Patient, levels = colnames(cnv_mat_alt))) %>%
arrange(Patient)
group_cols <- c("fast" = "#1b9e77", "delayed" = "#d95f02")
ha <- HeatmapAnnotation(
Group = annot_df$Group,
col = list(Group = group_cols),
annotation_name_side = "left",
show_annotation_name = TRUE
)
cnv_colors <- c(
"Deep Deletion" = "#d73027",
"Shallow Deletion" = "#fdae61",
"Diploid" = "#fff7bc",
"Gain" = "#abd9e9",
"Amplification" = "#4575b4"
)
ht <- Heatmap(
cnv_mat_alt,
name = "CNA",
col = cnv_colors,
rect_gp = gpar(col = "grey70", lwd = 0.4),
show_column_names = FALSE,
show_row_names = TRUE,
cluster_rows = TRUE,
cluster_columns = TRUE,
show_row_dend = TRUE,
show_column_dend = TRUE,
row_dend_side = "left",
column_dend_side = "top",
row_dend_width = unit(35, "mm"),
column_dend_height = unit(35, "mm"),
top_annotation = ha,
column_split = annot_df$Group
)
ht
ggforest(stats2,fontsize = 1)
ggforest(stats2,fontsize = 1)
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ `low switch commitment percentage` + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2,fontsize = 1)
ggsave('hazard_plot_switch_perc.svg',plot = last_plot(),dpi = 360,width = 25, height = 25, units = "cm")
surv_data_switch <- prova
surv_data_switch$"low switch commitment
percentage" <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$`low switch commitment
percentage` <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$`low switch commitment
percentage` <- 1
colnames(surv_data_switch)[4] = "age at diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ `low switch commitment
percentage` + `age at diagnosis` + subtype, data = surv_data_switch)
View(surv_data_switch)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ `low switch commitment percentage` + `age at diagnosis` + subtype, data = surv_data_switch)
colnames(surv_data_switch)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ `low switch commitment \npercentage` + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2,fontsize = 1)
ggsave('hazard_plot_switch_perc.svg',plot = last_plot(),dpi = 360,width = 25, height = 25, units = "cm")
surv_data_switch <- prova
surv_data_switch$"low switch commitment \npercentage" <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$`low switch commitment \npercentage` <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$`low switch commitment \npercentage` <- 1
colnames(surv_data_switch)[4] = "age at diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ `low switch commitment \npercentage` + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2,fontsize = 1)
ggsave('hazard_plot_switch_perc.svg',plot = last_plot(),dpi = 360,width = 25, height = 25, units = "cm")
surv_data_switch <- prova
surv_data_switch$"low switch commitment \npercentage" <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$`low switch commitment \npercentage` <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$`low switch commitment \npercentage` <- 1
colnames(surv_data_switch)[4] = "age at diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ `low switch commitment \npercentage` + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2,fontsize = 1)
surv_data_switch <- prova
surv_data_switch$"low switch commitment
percentage" <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$`low switch commitment \npercentage` <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$`low switch commitment \npercentage` <- 1
colnames(surv_data_switch)[4] = "age at diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ `low switch commitment \npercentage` + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2,fontsize = 1)
surv_data_switch <- prova
surv_data_switch$low_switch_commitment_percentage <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$low_switch_commitment_percentage <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$low_switch_commitment_percentage <- 1
colnames(surv_data_switch)[4] = "age at diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ low_switch_commitment_percentage + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2)
ggforest(stats2,fontsize = 1)
surv_data_switch <- prova
surv_data_switch$"low switch commitment \npercentage" <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$`low switch commitment \npercentage` <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$`low switch commitment \npercentage` <- 1
colnames(surv_data_switch)[4] = "age at diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ `low switch commitment \npercentage` + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2,fontsize = 1)
stats2
surv_data_switch <- prova
surv_data_switch$"low switch commitment\npercentage" <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$`low switch commitment\npercentage` <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$`low switch commitment\npercentage` <- 1
colnames(surv_data_switch)[4] = "age at diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ `low switch commitment\npercentage` + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2,fontsize = 1)
surv_data_switch <- prova
surv_data_switch$low_switch_commitment_percentage <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$low_switch_commitment_percentage <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$low_switch_commitment_percentage <- 1
colnames(surv_data_switch)[4] = "age at diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ low_switch_commitment_percentage + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2,fontsize = 1)
surv_data_switch <- prova
surv_data_switch$low_switch_commitment_percentage <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$low_switch_commitment_percentage <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$low_switch_commitment_percentage <- 1
colnames(surv_data_switch)[4] = "age at diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ low_switch_commitment_percentage + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2,fontsize = 1)
surv_data_switch <- prova
surv_data_switch$"low switch commitment\npercentage" <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$`low switch commitment\npercentage` <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$`low switch commitment\npercentage` <- 1
colnames(surv_data_switch)[4] = "age at diagnosis"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ `low switch commitment\npercentage` + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2,fontsize = 1)
surv_data_switch <- prova
surv_data_switch$low_switch_commitment_percentage <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$low_switch_commitment_percentage <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$low_switch_commitment_percentage <- 1
colnames(surv_data_switch)[4] = "age at diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ low_switch_commitment_percentage + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2,fontsize = 1)
ggsave('hazard_plot_switch_perc.svg',plot = last_plot(),dpi = 360,width = 25, height = 25, units = "cm")
surv_data_switch <- prova
surv_data_switch$"low switch commitment\npercentage" <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$`low switch commitment\npercentage` <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$`low switch commitment\npercentage` <- 1
colnames(surv_data_switch)[4] = "age at diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ `low switch commitment\npercentage` + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2,fontsize = 1)
ggsave('hazard_plot_switch_perc2.svg',plot = last_plot(),dpi = 360,width = 25, height = 25, units = "cm")
surv_data_switch <- prova
surv_data_switch$"low_switch_commitment_percentage" <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$low_switch_commitment_percentage <- 0
surv_data_switch[which(surv_data_switch$clust2 == 1),]$low_switch_commitment_percentage <- 1
colnames(surv_data_switch)[4] = "age at diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ Group2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#1b9e77','#d95f02'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ low_switch_commitment_percentage + `age at diagnosis` + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2,fontsize = 1)
ggforest(stats, fontsize = 1)
stats <- coxph(Surv(get(param.time), get(param)) ~ `delayed switch time` + `age at diagnosis` + subtype, data = surv_data)
summary(stats)
ggforest(stats, fontsize = 1)
