setwd("~/Desktop/Files_hg38")
source(file = 'clip_annotation_dassicode.R')
list.dirs()
list.files()
list.files(pattern = 'GSM')
list.files(pattern = '^GSM')
files <- list.files(x,pattern = '^GSM')
files <- list.files(list.dirs(),pattern = '^GSM')
apply(files,function(x){
print(x)
})
files <- list.files(list.dirs(),pattern = '^GSM')
lapply(files,function(x){
print(x)
})
rapply(files,function(x){
print(x)
})
typeof(files)
list_of_dataframes <- lapply(files, function(x) {
read.table(x, header = TRUE, sep = "\t")
})
View(list_of_dataframes)
list_of_dataframes <- lapply(files, function(x) {
read.table(x, header = TRUE, sep = "\t")
print(x)
})
lapply(files,function(x){
print(x)
})
pi <-lapply(files,function(x){
print(x)
})
lapply(files,function(x){
message("Currently loading: ", basename(x))
})
lapply(files,function(x){
message("Currently loading: ", x)
})
setwd("~/Desktop/m6a_rg4fisher")
FTO <- read.table('Files_hg38/FTO_ENCODE.bed',sep = '\t',header = F)
View(FTO)
# background size = 60660
RG4_seq <- read.table('Rg4_files/rg4seq_Rg4s_quadratlas_hg38_withAnnotSequence.bed',sep = '\t',header = T)
View(RG4_seq)
Rt_stop_prof <- read.table('Rg4_files/RT_stop_profiling_Rg4s_quadratlas_hg38_withAnnotSequence.bed',sep = '\t',header = T)
View(Rt_stop_prof)
# background size = 1917 ?
FTO_intersect_Rg4s <- read.table('Intersections/Intersect_rg4s_FTO_ENCODE_sub.bed',header = T,sep = '\t')
View(FTO_intersect_Rg4s)
# background size = 1917 ?
FTO_intersect_Rg4s <- read.table('Intersections/Intersect_rg4s_FTO_ENCODE_sub.bed',header = F,sep = '\t')
View(FTO_intersect_Rg4s)
FTO_intersect_RT_stop_prof <-read.table('Intersections/Intersect_RT_stop_profiling_FTO_ENCODE_sub.bed',header = F,sep = '\t')
setwd("~/Downloads")
#uploading Bad file and adapting the column names
fileRg4 <- read.table(
"RG4s_quadratlas_hg38_withAnnotSequence.bed",
header = F, sep="\t",stringsAsFactors=TRUE)
library(ggplot2)
library(survival)
library(survminer)
library(data.table)
library(RColorBrewer)
library(rstudioapi)
library(ggbreak)
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
survival <- fread("../Files_generated/TCGATimePoints.tsv",data.table=F)
sims <- fread("../Files_generated/final_patient.csv",data.table=F)
sims$Patient_ID <- sapply(sims$Patient,function(x) paste(strsplit(x,"-")[[1]][1:3],collapse="-"))
survival <- survival[which(survival$type=="BRCA"),]
survival$sim_time <- NA
survival$sim_perc <- NA
survival$subtype <- NA
subtypes <- fread("../Files_generated/Cancer_subtypes_list.tsv",data.table=F)
for(i in 1:nrow(survival)){
t <- which(sims$Patient_ID==survival$bcr_patient_barcode[i])
if(length(t)>0)
{
survival$sim_time[i] <- sims$Mean[t] # for every patient associo il tempo medio a cui avviene lo switch
survival$sim_perc[i] <- sims$Percentage_switch[t] # for every patients i associate its switch percentage: quante volte su cento avviene lo switch
}
t <- which(subtypes$COMMON==survival$bcr_patient_barcode[i])
if(length(t)>0)
{
survival$subtype[i] <- subtypes$Subtype[t][1] # associo anche il subtype
}
}
survival <- survival[which(!is.na(survival$sim_time)),]
hist(survival$sim_time,breaks=20,main="Switch time distribution",xlab="Patient mean switch time")
hist(survival$sim_perc[which(survival$sim_perc<100)],breaks=10,main="Switch percentage distribution\n(only for patients with percentages<100)",xlab="Patient mean switch percentage")
hist(survival$age_at_initial_pathologic_diagnosis,breaks=20,main="Age distribution",xlab="Age")
summary(survival$sim_time)
km<-kmeans(survival$sim_time, centers = 2)
survival$clust<-as.factor(km$cluster)
ggplot(survival, aes(x=sim_time, fill=clust))+
geom_histogram(bins = 30,
position = "identity",
alpha = 0.45,
color = "black", aes(y = after_stat(count / sum(count) * 100)))+
theme_minimal(base_size = 14)+
labs(x='Patients mean switch time', y='Percentage of patients', title='Switch time distribution') +
scale_fill_manual(name='Group',labels=c('Delayed','Fast'), values=c('#d95f02','#1b9e77'))
prova<-survival[order(survival$sim_time),,drop=F]
## For the switch percentage
km_perc<-kmeans(survival$sim_perc, centers = 2)
prova <-survival
prova$clust2<-as.factor(km_perc$cluster)
ggplot(prova, aes(x=sim_perc, fill=clust2))+
geom_histogram( bins = 30,position = "identity",
alpha = 0.45, color = "black",aes(y = after_stat(count /sum(count) * 100)))+
theme_minimal(base_size = 14) +
labs(x='Patient mean switch percentage', y='Counts', title='Switch percentage distribution') +
scale_fill_manual(name='',labels=c('Delayed','Fast'), values=c('#d95f02','#1b9e77'))+scale_y_break(c(5,82))
prova<-prova[order(prova$sim_perc),,drop=F]
qual_colors<-brewer.pal.info[brewer.pal.info$category=='qual',]
col_vector<-unlist(mapply(brewer.pal, qual_colors$maxcolors, rownames(qual_colors)))
colors<-sample(col_vector, 2)
surv_data <- survival
surv_data$delayed_switch_time <- as.integer(surv_data$clust)
surv_data[which(surv_data$delayed_switch_time == 2),]$delayed_switch_time <- 0
colnames(surv_data)[4] = "age_at_diagnosis"
param = "OS"
param.time = "OS.time"
fit = survfit(Surv(get(param.time), get(param)) ~ clust, data = surv_data)
plot(fit,xlab="Time (days)",ylab="Overall Survival",col=c('#d95f02','#1b9e77'),lwd=2,cex=1.5)
stats <- coxph(Surv(get(param.time), get(param)) ~ delayed_switch_time + age_at_diagnosis + subtype, data = surv_data)
summary(stats)
ggforest(stats)
ggsurvplot(fit,
conf.int=TRUE, # add confidence intervals
pval=TRUE, # show the p-value for the log-rank test
risk.table=TRUE, # show a risk table below the plot
legend.labs=c("delayed", "fast"), # change group labels
legend.title="Average switch time",  # add legend title
palette=c('#d95f02','#1b9e77'), # change colors of the groups
title="Kaplan-Meier Curve for Breast Cancer Survival", # add title to plot
risk.table.height=.2)
length(table(surv_data$age_at_diagnosis)) # 65
surv_data_switch <- prova
surv_data_switch$low_switch_commitment_percentage <- as.integer(surv_data_switch$clust2)
surv_data_switch[which(surv_data_switch$clust2 == 2),]$low_switch_commitment_percentage <- 1
surv_data_switch[which(surv_data_switch$clust2 == 1),]$low_switch_commitment_percentage <- 0
colnames(surv_data_switch)[4] = "age_at_diagnosis"
param = "OS"
param.time = "OS.time"
fit2 = survfit(Surv(get(param.time), get(param)) ~ clust2, data = surv_data_switch)
plot(fit2,xlab="Time (days)",ylab="Overall Survival",col=c('#d95f02','#1b9e77'),lwd=2,cex=1.5)
stats2 <- coxph(Surv(get(param.time), get(param)) ~ low_switch_commitment_percentage + age_at_diagnosis + subtype, data = surv_data_switch)
summary(stats2)
ggforest(stats2)
ggsurvplot(fit2,
conf.int=TRUE, # add confidence intervals
pval=TRUE, # show the p-value for the log-rank test
risk.table=TRUE, # show a risk table below the plot
legend.labs=c("high", "low"), # change group labels
legend.title="Switch percentage",  # add legend title
palette=c('#d95f02','#1b9e77'), # change colors of the groups
title="Kaplan-Meier Curve for Breast Cancer Survival", # add title to plot
risk.table.height=.2)
survival$groupST[which(survival$Mean>3290)] <- 1
survival$groupST[which(survival$sim_time>3290)] <- 1
survival$groupSP[which(survival$sim_perc<63)] <- 1
View(survival)
survival$groupST <- 0
survival$groupSP <- 0
survival$groupST[which(survival$sim_time>3290)] <- 1
survival$groupSP[which(survival$sim_perc<63)] <- 1
survival <- survival %>%
mutate(
GroupCombo = case_when(
groupST == 1 & groupSP == 0 ~ "Delayed",
groupST == 0 & groupSP == 1 ~ "low CP",
groupST == 1 & groupSP == 1 ~ "Delayed + low CP",
groupST == 0 & groupSP == 0 ~ "None"
)
)
library(dplyr)
survival <- survival %>%
mutate(
GroupCombo = dplyr::case_when(
groupST == 1 & groupSP == 0 ~ "Delayed",
groupST == 0 & groupSP == 1 ~ "low CP",
groupST == 1 & groupSP == 1 ~ "Delayed + low CP",
groupST == 0 & groupSP == 0 ~ "None"
)
)
table(df$GroupCombo)
View(survival)
table(survival$GroupCombo)
pal <- brewer.pal(4, "Paired")
pal
combo_cols <- c(
"Delayed" = pal[1],
"low CP" = pal[2],
"Delayed + low CP" = pal[3],
"None" = pal[4]
)
p3 <- ggplot(df, aes(x = Mean, y = Percentage_switch, color = GroupCombo)) +
geom_point(size = 3, alpha = 0.8) +
scale_color_manual(values = combo_cols) +
theme_minimal() +
labs(color = "Group combination")
p3 <- ggplot(survival, aes(x = sim_time, y = sim_perc, color = GroupCombo)) +
geom_point(size = 3, alpha = 0.8) +
scale_color_manual(values = combo_cols) +
theme_minimal() +
labs(color = "Group combination")
p3
