setwd("~/Desktop/Files_hg38")
source(file = 'clip_annotation_dassicode.R')
list.dirs()
list.files()
list.files(pattern = 'GSM')
list.files(pattern = '^GSM')
files <- list.files(x,pattern = '^GSM')
files <- list.files(list.dirs(),pattern = '^GSM')
apply(files,function(x){
print(x)
})
files <- list.files(list.dirs(),pattern = '^GSM')
lapply(files,function(x){
print(x)
})
rapply(files,function(x){
print(x)
})
typeof(files)
list_of_dataframes <- lapply(files, function(x) {
read.table(x, header = TRUE, sep = "\t")
})
View(list_of_dataframes)
list_of_dataframes <- lapply(files, function(x) {
read.table(x, header = TRUE, sep = "\t")
print(x)
})
lapply(files,function(x){
print(x)
})
pi <-lapply(files,function(x){
print(x)
})
lapply(files,function(x){
message("Currently loading: ", basename(x))
})
lapply(files,function(x){
message("Currently loading: ", x)
})
setwd("~/Desktop/m6a_rg4fisher")
FTO <- read.table('Files_hg38/FTO_ENCODE.bed',sep = '\t',header = F)
View(FTO)
# background size = 60660
RG4_seq <- read.table('Rg4_files/rg4seq_Rg4s_quadratlas_hg38_withAnnotSequence.bed',sep = '\t',header = T)
View(RG4_seq)
Rt_stop_prof <- read.table('Rg4_files/RT_stop_profiling_Rg4s_quadratlas_hg38_withAnnotSequence.bed',sep = '\t',header = T)
View(Rt_stop_prof)
# background size = 1917 ?
FTO_intersect_Rg4s <- read.table('Intersections/Intersect_rg4s_FTO_ENCODE_sub.bed',header = T,sep = '\t')
View(FTO_intersect_Rg4s)
# background size = 1917 ?
FTO_intersect_Rg4s <- read.table('Intersections/Intersect_rg4s_FTO_ENCODE_sub.bed',header = F,sep = '\t')
View(FTO_intersect_Rg4s)
FTO_intersect_RT_stop_prof <-read.table('Intersections/Intersect_RT_stop_profiling_FTO_ENCODE_sub.bed',header = F,sep = '\t')
setwd("~/Downloads")
#uploading Bad file and adapting the column names
fileRg4 <- read.table(
"RG4s_quadratlas_hg38_withAnnotSequence.bed",
header = F, sep="\t",stringsAsFactors=TRUE)
library(ggplot2)
library(survival)
library(survminer)
library(data.table)
library(RColorBrewer)
library(rstudioapi)
library(ggbreak)
library(dplyr)
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
survival <- fread("../Files_generated/TCGATimePoints.tsv",data.table=F)
survival <- fread("../Files_generated/TCGATimePoints.tsv",data.table=F)
sims <- fread("../Files_generated/final_patient.csv",data.table=F)
sims$Patient_ID <- sapply(sims$Patient,function(x) paste(strsplit(x,"-")[[1]][1:3],collapse="-"))
survival <- survival[which(survival$type=="BRCA"),]
survival$sim_time <- NA
survival$sim_perc <- NA
survival$subtype <- NA
subtypes <- fread("../Files_generated/Cancer_subtypes_list.tsv",data.table=F)
for(i in 1:nrow(survival)){
t <- which(sims$Patient_ID==survival$bcr_patient_barcode[i])
if(length(t)>0)
{
survival$sim_time[i] <- sims$Mean[t] # for every patient associo il tempo medio a cui avviene lo switch
survival$sim_perc[i] <- sims$Percentage_switch[t] # for every patients i associate its switch percentage: quante volte su cento avviene lo switch
}
t <- which(subtypes$COMMON==survival$bcr_patient_barcode[i])
if(length(t)>0)
{
survival$subtype[i] <- subtypes$Subtype[t][1] # associo anche il subtype
}
}
survival <- survival[which(!is.na(survival$sim_time)),]
cnv_levels <- c("Diploid", "Gain", "Amplification", "Shallow Deletion", "Deep Deletion")
pattern <- paste0("^\\s*(.+?)\\s+(", paste(cnv_levels, collapse="|"), ")\\s*$")
cnv_long <- survival %>%
select(Patient, Notes_situation_cp) %>%
mutate(Notes_situation_cp = as.character(Notes_situation_cp)) %>%
separate_rows(Notes_situation_cp, sep = "\\s*\\|\\s*") %>%
mutate(Notes_situation_cp = str_squish(Notes_situation_cp)) %>%
mutate(
Gene   = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,2],
Status = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,3]
) %>%
mutate(
Status = case_when(
str_to_lower(Status) == "diploid" ~ "Diploid",
str_to_lower(Status) == "gain" ~ "Gain",
str_to_lower(Status) == "amplification" ~ "Amplification",
str_to_lower(Status) == "shallow deletion" ~ "Shallow Deletion",
str_to_lower(Status) == "deep deletion" ~ "Deep Deletion",
TRUE ~ Status
)
)
View(survival)
View(survival)
View(sims)
View(subtypes)
View(subtypes)
View(sims)
View(survival)
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
survival <- fread("../Files_generated/TCGATimePoints.tsv",data.table=F)
sims <- fread("../Files_generated/final_patient.csv",data.table=F)
sims$Patient_ID <- sapply(sims$Patient,function(x) paste(strsplit(x,"-")[[1]][1:3],collapse="-"))
survival <- survival[which(survival$type=="BRCA"),]
survival$sim_time <- NA
survival$sim_perc <- NA
survival$subtype <- NA
View(sims)
sims <- sims[which(!is.na$Mean),]
sims <- sims[which(!is.na(sims$Mean)),]
cnv_long <- sims %>%
select(Patient, Notes_situation_cp) %>%
mutate(Notes_situation_cp = as.character(Notes_situation_cp)) %>%
separate_rows(Notes_situation_cp, sep = "\\s*\\|\\s*") %>%
mutate(Notes_situation_cp = str_squish(Notes_situation_cp)) %>%
mutate(
Gene   = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,2],
Status = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,3]
) %>%
mutate(
Status = case_when(
str_to_lower(Status) == "diploid" ~ "Diploid",
str_to_lower(Status) == "gain" ~ "Gain",
str_to_lower(Status) == "amplification" ~ "Amplification",
str_to_lower(Status) == "shallow deletion" ~ "Shallow Deletion",
str_to_lower(Status) == "deep deletion" ~ "Deep Deletion",
TRUE ~ Status
)
)
library(ggplot2)
library(survival)
library(survminer)
library(data.table)
library(RColorBrewer)
library(rstudioapi)
library(ggbreak)
library(dplyr)
library(ComplexHeatmap)
library(tidyr)
cnv_long <- sims %>%
select(Patient, Notes_situation_cp) %>%
mutate(Notes_situation_cp = as.character(Notes_situation_cp)) %>%
separate_rows(Notes_situation_cp, sep = "\\s*\\|\\s*") %>%
mutate(Notes_situation_cp = str_squish(Notes_situation_cp)) %>%
mutate(
Gene   = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,2],
Status = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,3]
) %>%
mutate(
Status = case_when(
str_to_lower(Status) == "diploid" ~ "Diploid",
str_to_lower(Status) == "gain" ~ "Gain",
str_to_lower(Status) == "amplification" ~ "Amplification",
str_to_lower(Status) == "shallow deletion" ~ "Shallow Deletion",
str_to_lower(Status) == "deep deletion" ~ "Deep Deletion",
TRUE ~ Status
)
)
library(stringstatic)
install.packages('stringstatic')
library(stringstatic)
cnv_long <- sims %>%
select(Patient, Notes_situation_cp) %>%
mutate(Notes_situation_cp = as.character(Notes_situation_cp)) %>%
separate_rows(Notes_situation_cp, sep = "\\s*\\|\\s*") %>%
mutate(Notes_situation_cp = str_squish(Notes_situation_cp)) %>%
mutate(
Gene   = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,2],
Status = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,3]
) %>%
mutate(
Status = case_when(
str_to_lower(Status) == "diploid" ~ "Diploid",
str_to_lower(Status) == "gain" ~ "Gain",
str_to_lower(Status) == "amplification" ~ "Amplification",
str_to_lower(Status) == "shallow deletion" ~ "Shallow Deletion",
str_to_lower(Status) == "deep deletion" ~ "Deep Deletion",
TRUE ~ Status
)
)
cnv_long <- sims %>%
select(Patient, Notes_situation_cp) %>%
mutate(Notes_situation_cp = as.character(Notes_situation_cp)) %>%
separate_rows(Notes_situation_cp, sep = "\\s*\\|\\s*") %>%
mutate(Notes_situation_cp = str_squish(Notes_situation_cp)) %>%
mutate(
Gene   = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,2],
Status = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,3]
) %>%
mutate(
Status = dplyr::case_when(
str_to_lower(Status) == "diploid" ~ "Diploid",
str_to_lower(Status) == "gain" ~ "Gain",
str_to_lower(Status) == "amplification" ~ "Amplification",
str_to_lower(Status) == "shallow deletion" ~ "Shallow Deletion",
str_to_lower(Status) == "deep deletion" ~ "Deep Deletion",
TRUE ~ Status
)
)
sims <- sims[which(!is.na(sims$Mean)),]
cnv_long <- sims %>%
select(Patient, Notes_situation_cp) %>%
mutate(Notes_situation_cp = as.character(Notes_situation_cp)) %>%
separate_rows(Notes_situation_cp, sep = "\\s*\\|\\s*") %>%
mutate(Notes_situation_cp = str_squish(Notes_situation_cp)) %>%
mutate(
Gene   = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,2],
Status = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,3]
) %>%
mutate(
Status = case_when(
str_to_lower(Status) == "diploid" ~ "Diploid",
str_to_lower(Status) == "gain" ~ "Gain",
str_to_lower(Status) == "amplification" ~ "Amplification",
str_to_lower(Status) == "shallow deletion" ~ "Shallow Deletion",
str_to_lower(Status) == "deep deletion" ~ "Deep Deletion",
TRUE ~ Status
)
)
library(stringr)
cnv_long <- sims %>%
select(Patient, Notes_situation_cp) %>%
mutate(Notes_situation_cp = as.character(Notes_situation_cp)) %>%
separate_rows(Notes_situation_cp, sep = "\\s*\\|\\s*") %>%
mutate(Notes_situation_cp = str_squish(Notes_situation_cp)) %>%
mutate(
Gene   = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,2],
Status = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,3]
) %>%
mutate(
Status = case_when(
str_to_lower(Status) == "diploid" ~ "Diploid",
str_to_lower(Status) == "gain" ~ "Gain",
str_to_lower(Status) == "amplification" ~ "Amplification",
str_to_lower(Status) == "shallow deletion" ~ "Shallow Deletion",
str_to_lower(Status) == "deep deletion" ~ "Deep Deletion",
TRUE ~ Status
)
)
cnv_wide <- cnv_long %>%
group_by(Gene, Patient) %>%
summarize(Status = Status[1], .groups = "drop") %>%
pivot_wider(names_from = Patient, values_from = Status, values_fill = "Diploid")
cnv_mat <- as.matrix(cnv_wide[,-1])
rownames(cnv_mat) <- cnv_wide$Gene
altered_genes <- rownames(cnv_mat)[apply(cnv_mat, 1, function(x) any(x != "Diploid"))]
cnv_mat_alt <- cnv_mat[altered_genes, , drop = FALSE]
annot_df <- df %>%
distinct(Patient, Group) %>%
filter(Patient %in% colnames(cnv_mat_alt)) %>%
mutate(Patient = factor(Patient, levels = colnames(cnv_mat_alt))) %>%
arrange(Patient)
annot_df <- sims %>%
distinct(Patient, Group) %>%
filter(Patient %in% colnames(cnv_mat_alt)) %>%
mutate(Patient = factor(Patient, levels = colnames(cnv_mat_alt))) %>%
arrange(Patient)
View(sims)
sims$groupST <- 0
sims$groupSP <- 0
sims$groupST[which(sims$Mean>3290)] <- 1
sims$groupSP[which(sims$Percentage_switch<63)] <- 1
sims <- sims[which(!is.na(sims$Mean)),]
sims <- sims %>%
mutate(Group = case_when(
groupST == 1 ~ "delayed",
groupST == 0 ~ "fast",
TRUE ~ NA_character_
))
cnv_long <- sims %>%
select(Patient, Notes_situation_cp) %>%
mutate(Notes_situation_cp = as.character(Notes_situation_cp)) %>%
separate_rows(Notes_situation_cp, sep = "\\s*\\|\\s*") %>%
mutate(Notes_situation_cp = str_squish(Notes_situation_cp)) %>%
mutate(
Gene   = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,2],
Status = str_match(Notes_situation_cp, regex(pattern, ignore_case = TRUE))[,3]
) %>%
mutate(
Status = case_when(
str_to_lower(Status) == "diploid" ~ "Diploid",
str_to_lower(Status) == "gain" ~ "Gain",
str_to_lower(Status) == "amplification" ~ "Amplification",
str_to_lower(Status) == "shallow deletion" ~ "Shallow Deletion",
str_to_lower(Status) == "deep deletion" ~ "Deep Deletion",
TRUE ~ Status
)
)
cnv_wide <- cnv_long %>%
group_by(Gene, Patient) %>%
summarize(Status = Status[1], .groups = "drop") %>%
pivot_wider(names_from = Patient, values_from = Status, values_fill = "Diploid")
cnv_mat <- as.matrix(cnv_wide[,-1])
rownames(cnv_mat) <- cnv_wide$Gene
altered_genes <- rownames(cnv_mat)[apply(cnv_mat, 1, function(x) any(x != "Diploid"))]
cnv_mat_alt <- cnv_mat[altered_genes, , drop = FALSE]
annot_df <- sims %>%
distinct(Patient, Group) %>%
filter(Patient %in% colnames(cnv_mat_alt)) %>%
mutate(Patient = factor(Patient, levels = colnames(cnv_mat_alt))) %>%
arrange(Patient)
group_cols <- c("fast" = "#1b9e77", "delayed" = "#d95f02")
ha <- HeatmapAnnotation(
Group = annot_df$Group,
col = list(Group = group_cols),
annotation_name_side = "left",
show_annotation_name = TRUE
)
cnv_colors <- c(
"Deep Deletion" = "#d73027",
"Shallow Deletion" = "#fdae61",
"Diploid" = "#fff7bc",
"Gain" = "#abd9e9",
"Amplification" = "#4575b4"
)
ht <- Heatmap(
cnv_mat_alt,
name = "CNA",
col = cnv_colors,
rect_gp = gpar(col = "grey70", lwd = 0.4),
show_column_names = FALSE,
show_row_names = TRUE,
cluster_rows = TRUE,
cluster_columns = TRUE,
show_row_dend = TRUE,
show_column_dend = TRUE,
row_dend_side = "left",
column_dend_side = "top",
row_dend_width = unit(35, "mm"),
column_dend_height = unit(35, "mm"),
top_annotation = ha,
column_split = annot_df$Group
)
ht
